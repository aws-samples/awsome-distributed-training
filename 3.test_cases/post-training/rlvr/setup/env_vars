# Ray Cluster Environment Variables
# export IMAGE="hiyouga/verl:ngc-th2.6.0-cu126-vllm0.8.4-flashinfer0.2.2-cxx11abi0"

# Docker file
export AWS_REGION=$(aws ec2 describe-availability-zones --output text --query 'AvailabilityZones[0].[RegionName]')
export ACCOUNT=$(aws sts get-caller-identity --query Account --output text)
export REGISTRY=${ACCOUNT}.dkr.ecr.${AWS_REGION}.amazonaws.com/
export IMAGE=rlvr
export TAG=ngc-th2.6.0-cu126-vllm0.8.4-flashinfer0.2.2-cxx11abi0

# Cluster Details
export EKS_CLUSTER_NAME=sagemaker-mvincig-rlvr-e66849d3-eks
export NUM_NODES=4                    # Single source of truth for number of nodes
export NUM_GPU_PER_NODE=8
export NUM_EFA_PER_NODE=16
export PRIVATE_SUBNET_ID="subnet-0d808f7937de12b4f"
export SECURITY_GROUP_ID="sg-0aa152ec598835c93"


# Ray configs
export MODEL_NAME="Qwen3-8B"
# export MODEL_PATH="Qwen/Qwen2.5-32B" # Set this to load model from HuggingFace
#export MODEL_PATH="Qwen/Qwen3-0.6B-Base"
export MODEL_PATH="Qwen/Qwen3-8B"
export RAY_DATA_HOME="/fsx/verl" # Shared storage path for checkpoints and data
export VERL_HOME="fsx/verl"
export RAY_ADDRESS="http://localhost:8266"
# export RUNTIME_ENV="./recipe/dapo/runtime_env.yaml"
export WORKING_DIR="$(pwd)/verl"

# Job Env Vars (using NUM_NODES for consistency)
export HF_TOKEN= <your HF token>
export GPUS_PER_NODE=8
export NCCL_DEBUG=INFO
# Memory optimization settings
export RAY_memory_usage_threshold=0.85

# Add these to reduce I/O pressure
export TRAIN_BATCH_SIZE=32    # Reduced from 512
export GEN_BATCH_SIZE=384      # Reduced from 1536
export N_RESP_PER_PROMPT=2     # Reduced from 16

# Observability with HyperPod - Amazon Managed Prometheus & Grafana
export AMP_WORKSPACE_ID="ws-b1b56a1d-2b76-48c8-91d2-e65db2925090"
export AMP_ENDPOINT="https://aps-workspaces.${AWS_REGION}.amazonaws.com/workspaces/${AMP_WORKSPACE_ID}"
export GRAFANA_WORKSPACE_ID="g-6580cb3aa9"
export GRAFANA_ENDPOINT="https://${GRAFANA_WORKSPACE_ID}.grafana-workspace.${AWS_REGION}.amazonaws.com"
export CLUSTER_ID="0gto4cvyhcmd"
export CLUSTER_NAME="mvincig-rlvr"
export RAY_NAMESPACE="default"  # Namespace where RayCluster runs
